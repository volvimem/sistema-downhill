<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - DH PE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f4f7f6; color: #333; padding-bottom: 50px; }

        .top-bar { 
            background: #003399; color: white; padding: 15px 30px; 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .saldo-topo { background: #ffcc00; color: #003399; padding: 8px 15px; border-radius: 8px; font-weight: 900; font-size: 18px; }

        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px; }
        .stat-icon { width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .pagas { background: #e8f5e9; color: #27ae60; }
        .pendentes { background: #fff3e0; color: #f39c12; }

        /* Seções */
        .secao-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .secao-card h3 { margin-bottom: 15px; color: #003399; border-left: 5px solid #ffcc00; padding-left: 10px; font-size: 16px; }

        /* Configuração PIX */
        .config-pix { background: #fdfdfd; border: 1px solid #eee; display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end; }
        .input-group { display: flex; flex-direction: column; gap: 5px; flex: 1; min-width: 200px; }
        .input-group label { font-size: 12px; font-weight: bold; color: #666; }
        .input-group input { padding: 10px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .btn-salvar-pix { background: #003399; color: white; border: none; padding: 11px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; color: #888; font-size: 12px; border-bottom: 2px solid #f4f4f4; text-transform: uppercase; }
        td { padding: 15px 12px; border-bottom: 1px solid #f4f4f4; font-size: 14px; }

        .btn-detalhe { background: #eee; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 12px; }

        /* Modal */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:200; justify-content:center; align-items:center; }
        .modal-content { background:white; padding:30px; border-radius:20px; width:90%; max-width:400px; }
        .modal-content p { margin-bottom: 10px; font-size: 15px; color: #444; }
        .modal-content strong { color: #003399; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div><i class="fas fa-bicycle"></i> <strong>ADMIN | <span id="etapa-nome">ETAPA</span></strong></div>
        <div class="saldo-topo" id="saldo-atual">R$ 0,00</div>
    </div>

    <div class="container">
        
        <div class="secao-card config-pix">
            <div style="width: 100%; margin-bottom: 10px;">
                <h3><i class="fas fa-id-card"></i> Dados de Recebimento da Etapa</h3>
            </div>
            <div class="input-group">
                <label>Chave PIX</label>
                <input type="text" id="chave-pix-input" placeholder="CPF, E-mail ou Celular">
            </div>
            <div class="input-group">
                <label>Titular da Conta</label>
                <input type="text" id="titular-pix-input" placeholder="Nome Completo">
            </div>
            <button class="btn-salvar-pix" onclick="salvarConfigPix()">SALVAR DADOS</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon pagas"><i class="fas fa-check-circle"></i></div>
                <div><p style="font-size: 11px; color: #888;">INSCRIÇÕES PAGAS</p><h2 id="count-pagas">0</h2></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon pendentes"><i class="fas fa-clock"></i></div>
                <div><p style="font-size: 11px; color: #888;">PENDENTES</p><h2 id="count-pendentes">0</h2></div>
            </div>
        </div>

        <div class="secao-card">
            <h3>Gerenciar Inscritos</h3>
            <table>
                <thead><tr><th>ATLETA</th><th>CATEGORIA</th><th>STATUS</th><th></th></tr></thead>
                <tbody id="lista-atletas"></tbody>
            </table>
        </div>
    </div>

    <div id="modalAtleta" class="modal">
        <div class="modal-content">
            <h3 id="det-nome" style="color:#003399; margin-bottom: 20px;">Nome do Atleta</h3>
            <p><strong><i class="fas fa-map-marker-alt"></i> Cidade:</strong> <span id="det-cidade"></span></p>
            <p><strong><i class="fas fa-id-card"></i> CPF:</strong> <span id="det-cpf"></span></p>
            <p><strong><i class="fas fa-users"></i> Equipe:</strong> <span id="det-equipe"></span></p>
            <p><strong><i class="fas fa-tag"></i> Categoria:</strong> <span id="det-cat"></span></p>
            
            <button id="btn-aprovar-manual" style="width:100%; margin-top:20px; padding:15px; background:#27ae60; color:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer; display:none;">CONFIRMAR PAGAMENTO</button>
            <button onclick="fecharModal()" style="width:100%; margin-top:10px; padding:10px; background:#f4f4f4; border:none; border-radius:12px; cursor:pointer; font-weight:bold; color:#666;">VOLTAR</button>
        </div>
    </div>

    <script>
        const etapaAtual = localStorage.getItem('adminEtapa') || "OURICURI";
        
        let db_atletas = {
            "OURICURI": [
                { id: 1, nome: "Bruno Rocha", categoria: "Elite", status: "Pendente", cpf: "123.456.789-00", equipe: "Sertão DH", cidade: "Ouricuri-PE" },
                { id: 2, nome: "João Silva", categoria: "Master A", status: "Pago", cpf: "444.555.666-11", equipe: "Avulso", cidade: "Araripina-PE" }
            ],
            "CARUARU": [
                { id: 3, nome: "Ricardo Melo", categoria: "Master B", status: "Pago", cpf: "987.654.321-00", equipe: "DH Caruaru", cidade: "Caruaru-PE" }
            ]
        };

        let historicoKey = `historico_${etapaAtual}`;
        let pixKey = `pix_config_${etapaAtual}`;
        let historico = JSON.parse(localStorage.getItem(historicoKey)) || [];
        
        function carregarConfigPix() {
            const config = JSON.parse(localStorage.getItem(pixKey));
            if(config) {
                document.getElementById('chave-pix-input').value = config.chave;
                document.getElementById('titular-pix-input').value = config.titular;
            }
        }

        function salvarConfigPix() {
            const chave = document.getElementById('chave-pix-input').value;
            const titular = document.getElementById('titular-pix-input').value;
            localStorage.setItem(pixKey, JSON.stringify({ chave, titular }));
            alert("Dados PIX salvos!");
        }

        function atualizarPainel() {
            document.getElementById('etapa-nome').innerText = etapaAtual;
            const lista = document.getElementById('lista-atletas');
            lista.innerHTML = "";
            let pagas = 0, pendentes = 0;

            const atletasEtapa = db_atletas[etapaAtual] || [];

            atletasEtapa.forEach(a => {
                if(a.status === "Pago") pagas++; else pendentes++;
                lista.innerHTML += `
                    <tr>
                        <td><strong>${a.nome}</strong></td>
                        <td>${a.categoria}</td>
                        <td><b style="color:${a.status==='Pago'?'#27ae60':'#f39c12'}">${a.status}</b></td>
                        <td style="text-align:right"><button class="btn-detalhe" onclick="verAtleta(${a.id})">DETALHES</button></td>
                    </tr>`;
            });

            document.getElementById('count-pagas').innerText = pagas;
            document.getElementById('count-pendentes').innerText = pendentes;
            
            // O saldo ainda é calculado pelo histórico interno para manter a precisão
            const total = historico.filter(h => h.tipo === 'entrada').reduce((acc, h) => acc + h.valor, 0);
            document.getElementById('saldo-atual').innerText = "R$ " + total.toFixed(2);
            
            localStorage.setItem(historicoKey, JSON.stringify(historico));
        }

        function verAtleta(id) {
            const a = db_atletas[etapaAtual].find(x => x.id === id);
            document.getElementById('det-nome').innerText = a.nome;
            document.getElementById('det-cidade').innerText = a.cidade;
            document.getElementById('det-cpf').innerText = a.cpf;
            document.getElementById('det-equipe').innerText = a.equipe;
            document.getElementById('det-cat').innerText = a.categoria;

            const btn = document.getElementById('btn-aprovar-manual');
            btn.style.display = a.status === "Pendente" ? "block" : "none";
            btn.onclick = () => { 
                a.status = "Pago"; 
                historico.push({ data: new Date().toLocaleDateString(), desc: `Inscrição: ${a.nome}`, valor: 120.00, tipo: "entrada" });
                fecharModal(); 
                atualizarPainel(); 
            };
            document.getElementById('modalAtleta').style.display = "flex";
        }

        function fecharModal() { document.getElementById('modalAtleta').style.display = "none"; }
        
        carregarConfigPix();
        atualizarPainel();
    </script>
</body>
</html>